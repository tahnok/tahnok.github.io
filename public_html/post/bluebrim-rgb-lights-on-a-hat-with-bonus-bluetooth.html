<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>BLUEBRIM: RGB lights on a hat with bonus bluetooth</title>
  <meta name="description" content="I recently needed to look swanky for a 1920s themed Holiday/Christmas party and I asked myself: What’s the swankiest?">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.tahnok.me/post/bluebrim-rgb-lights-on-a-hat-with-bonus-bluetooth.html">
  <link rel="alternate" type="application/rss+xml" title="(Fake) Markov Chains" href="https://blog.tahnok.me/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">(Fake) Markov Chains</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/archive/">Archive</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <a class="page-link" href="https://twitter.com/tahnok">@tahnok</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">BLUEBRIM: RGB lights on a hat with bonus bluetooth</h1>
    <p class="post-meta">Dec 14, 2015</p>
  </header>

  <article class="post-content">
    <p>I recently needed to look swanky for a 1920s themed Holiday/Christmas party and I asked myself: What’s the swankiest?</p>

<p><img src="../images/bluebrim_thinking.gif" alt="gif of me thinking then light going off" /></p>

<p>Of course! RGD LEDs on a hat! Controlled by Bluetooth! I shall call it… Project BLUE BRIM (because code names are awesome)</p>

<h2 id="hardware">Hardware</h2>

<p>A trip to the second hand store and a pair of sciscorrs to remove an unwanted bow later, I had myself a pin stripe hat like this:</p>

<p><img src="../images/bluebrim_nolights.png" alt="My hat before I started" /></p>

<p>next I had to acquire the rest of my materials as follows:</p>

<ul>
  <li>1 <a href="https://www.adafruit.com/products/659">Adafruit Flora</a> at room temperature</li>
  <li>1 <a href="https://www.adafruit.com/products/2487">Flora Bluefruit LE Module</a> sifted</li>
  <li>a <a href="https://www.adafruit.com/products/1376">34 Neopixel long strip</a> lightly buttered and cut down to size</li>
  <li>1 Lithium Ion Batter at 3.7v. I went with this <a href="https://www.adafruit.com/products/328">2500mAh model</a>, but it’s a bit… overkill</li>
</ul>

<p>Assembly is relatively straightforward. The circuit diagram looks like this:</p>

<p><img src="../images/bluebrim_circuitdiagram.jpg" alt="Hand-drawn bespoke circuit diagram" /></p>

<p>Basically, the Bluetooth module is connected to the serial pins on the Flora.
Next, the Neopixel strip connected by attaching D6 to DIN, and VBATT to VIN (and GND to GND)</p>

<p>All soldered together it looks like this</p>

<p><img src="../images/bluebrim_hatinside.jpg" alt="Inside of the hat" /></p>

<p>I attached the LEDs to the hat by cutting a small whole with a sharp knife at the back of the hat large enough to fit the connectors.
I then used the adhesive backing on the strip to attach it to the hat, and it seems to be holding well.
On the top of the hat, I folded a few small strips of Gorilla tape in on itself and stuck those on the back of the flora and the ble module.
Finally, I slipped the battery into the small inner brim, and taped it to the back side of the hat.
When put together like this, it was actually really comfortable to wear.
It’s a bit off balance, so I wouldn’t recommend trying any hat tricks.</p>

<h2 id="software">Software</h2>

<p>Writing the software for the hat was actually my favourite part.
Step 1 was getting the bluetooth stuff wired up.
Just like my <a href="http://blog.tahnok.me/post/makerfaire-ottawa-rule-110">last project</a> I tried to write my own bluetooth socket reading <a href="https://github.com/tahnok/BlueBrim/commit/dd293916fff1c27bf15fd0662f389c0247ae8b09">from scratch</a> but it was a bit too hacky for my liking.
Instead, I used the packet parser that <a href="https://github.com/adafruit/Adafruit_BluefruitLE_nRF51/blob/master/examples/neopixel_picker/packetParser.cpp">adafruit provides</a>, but I made sure to study the source closely to try and pick up some tricks for next time.
Basically, it looks like using a few nested loops and a timeout is the way to go.</p>

<p>The next bit was my favourite favourite part: MAKING PRETTY LIGHT PATTERNS!</p>

<p>Since I was going to use the <a href="https://play.google.com/store/apps/details?id=com.adafruit.bluefruit.le.connect">Adafruit Bluefruit LE Connect App</a> and they have a neat control pad with 8 buttons, I figured I would need 8 patterns.
Because there were 2 sections, I decided that 4 patterns would be multi colour, and 4 patterns would use the current colour chosen with the colour picker part of the app.</p>

<p>The 4 multicolour patterns are:</p>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L41">SPARKLE</a> which has a single randomly coloured pixel.
It looks like this:</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_sparkle.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L47">CYCLE</a> which fades through 256 colours, with the whole strip lit with one colour at a time.</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_cycle.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L55">RAINBOW</a> which has a continuously changing section of rainbow, where each pixel is a different colour</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_rainbow.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L62">PARTY</a> where each pixel is a random colour</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_party.mp4"></video>

<p>The 4 single colour patterns are:</p>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L70">CYLON</a> (or KITT depending on how old you are) has one pixel sliding back and forth across the front of the hat</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_cylon.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L84">SOLID</a> it’s a solid colour. What more do you want?</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_solid.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L91">PULSE</a> slowly changes the brightness from nothing, to full brightness, back down to nothing again</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_pulse.mp4"></video>

<p><a href="https://github.com/tahnok/BlueBrim/blob/master/colors.cpp#L106">TWIST</a> has a single pixel spinning around and around (and around (and around))</p>

<video loop="" muted="" width="75%" controls="" src="../images/bluebrim_twist.mp4"></video>

<p>You can see my source code in it’s entireity on my <a href="https://github.com/tahnok/BlueBrim">BlueBrim repo on Github</a>, which uses some fancy multi file arduino to make it a bit easier to read.
I hope you learned something reading this, as a thank you here is a picture of my dog wearing the miniature version of this</p>

<p><img src="../images/bluebrim_ada_hat.jpg" alt="ada wearing a pretty hat" /></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">(Fake) Markov Chains</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>(Fake) Markov Chains</li>
          <li><a href="mailto:tahnok@gmail.com">tahnok@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/tahnok">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">tahnok</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/tahnok">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">tahnok</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">WARNING: The content contained herein may or may not be sensical. Side effects may include laughter, anger, shallow thoughts, deep thoughts and blindness. Reader discretion is advised
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
